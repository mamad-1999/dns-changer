package dns

import (
	"fmt"
	"os/exec"
	"strings"

	"github.com/mamad-1999/dns-changer/config"
	"github.com/mamad-1999/dns-changer/utils"
)

func BuildResolvContent(config config.DnsConfig) string {
	var resolvContent strings.Builder
	resolvContent.WriteString("# Generated by Dns-changer\n")
	for _, server := range config.Servers {
		resolvContent.WriteString(fmt.Sprintf("nameserver %s\n", server))
	}
	return resolvContent.String()
}

func WriteToResolv(content string) error {
	cmd := exec.Command("sudo", "sh", "-c", fmt.Sprintf("echo '%s' > /etc/resolv.conf", content))
	if err := cmd.Run(); err != nil {
		utils.HandleError(err, "Error writing to /etc/resolv.conf")
		return err
	}
	return nil
}
